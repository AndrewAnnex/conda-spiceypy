# AppVeyor.com is a Continuous Integration service to build and run tests under Windows
# This yml file was made in part by looking at the yml files for conda and astropy.

# This is not a .NET project, so we build SpiceyPy in the install step.
build: off

environment:
  BINSTAR_TOKEN:
    secure: 3PbBhttz0hZjGherXRyVjGaIsCCzKFPVkS0mpolnTbtAkQrRN32arMVJN+wbk+Vm

  matrix:
      - PYTHON: "C:\\Python27-x64"
        CONDA: "C:\\Miniconda-x64"
        CONDA_BUILDS: C:\\Miniconda-x64\conda-bld\win-64
        PYTHON_VERSION: "2.7.x"
        ARCH: "64"
        PLAT_NAME: "win-amd64"
        PY_TAG: "cp27"

      - PYTHON: "C:\\Python35-x64"
        CONDA: "C:\\Miniconda35-x64"
        CONDA_BUILDS: C:\\Miniconda35-x64\conda-bld\win-64
        PYTHON_VERSION: "3.5.x"
        ARCH: "64"
        WINDOWS_SDK_VERSION: "v7.1"
        PLAT_NAME: "win-amd64"
        PY_TAG: "cp35"

platform:
  - x64

install:
  - set PATH=%CONDA%;%CONDA%/Scripts;%CONDA%/Library/bin;%PATH%
  # Update to a known good conda, found from https://github.com/numba/numba/blob/master/appveyor.yml
  # (to workaround http://help.appveyor.com/discussions/problems/4910)
  - "conda install -q -y conda=4.1.4"
  - "conda install -q -y conda-build anaconda-client"
  - IF "%ARCH%"=="32" (call "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" x86) ELSE (ECHO "probably a 64bit build")
  - IF "%ARCH%"=="64" (call "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" amd64) ELSE (ECHO "probably a 32bit build")
  - "conda build spiceypy -q --no-anaconda-upload"
  - ps: mv $env:CONDA\conda-bld\win-64 ./
  - set PATH=%BK_PATH%

artifacts:
  # we only are building 64 bit win here
  path: win-64/*.tar.bz2

deploy_script:
  - ps: If ($env:APPVEYOR_REPO_BRANCH -eq "master") { anaconda -t $env:BINSTAR_TOKEN upload ./win-64/*.tar.bz2 -u andrewannex } Else { "Not on Master, won't deploy" }

on_success:
  - ECHO "DONE"
